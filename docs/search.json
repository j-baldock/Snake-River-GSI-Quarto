[
  {
    "objectID": "Landscape Covariates/Groundwater/GroundwaterIndex.html",
    "href": "Landscape Covariates/Groundwater/GroundwaterIndex.html",
    "title": "\n7  Groundwater\n",
    "section": "",
    "text": "7.1 Data\nLoad spring prevalence rasters, lakes, basin and flowline\nCode# spring prevalence from Maxent: complete tiff and buffered/no lake tiff\nspring_full &lt;- rast(\"/Users/jeffbaldock/Library/CloudStorage/GoogleDrive-jbaldock@uwyo.edu/Shared drives/wyo-coop-baldock/UWyoming/Snake River Cutthroat/Analyses/Groundwater Seeps/SpringTIFFs/SpringPrev_SnakeGreys_BedSurf.tif\")\n\n# lakes in Upper Snake\nlakes &lt;- vect(\"/Users/jeffbaldock/Library/CloudStorage/GoogleDrive-jbaldock@uwyo.edu/Shared drives/wyo-coop-baldock/UWyoming/Snake River Cutthroat/Data/Spatial/Lakes/UpperSnake_Lakes.shp\") \n\n# basin without lakes\nbasin &lt;- vect(\"/Users/jeffbaldock/Library/CloudStorage/GoogleDrive-jbaldock@uwyo.edu/Shared drives/wyo-coop-baldock/UWyoming/Snake River Cutthroat/Data/Spatial/Basin Delineation/BasinDelineation/MajorBasins_Watersheds.shp\") \nbasin &lt;- subset(basin, basin$site %in% c(\"UpperSnake\", \"Greys\"))\nbasin_nolakes &lt;- erase(basin, lakes)\n\n# flowline\nflowline &lt;- vect(\"/Users/jeffbaldock/Library/CloudStorage/GoogleDrive-jbaldock@uwyo.edu/Shared drives/wyo-coop-baldock/UWyoming/Snake River Cutthroat/Analyses/Snake River GSI Quarto/Landscape Covariates/Watershed Delineation/SnakeGreys_flowline.shp\")\nflowbuff &lt;- flowline %&gt;% buffer(width = 100)\nRemove lakes and buffer to flowline\nCodespring_nolakes &lt;- mask(spring_full, basin_nolakes)\nspring_nolakes_buff100 &lt;- mask(spring_nolakes, flowbuff)\nWrite-out spring prevalence rasters\nCodewriteRaster(spring_nolakes, \"/Users/jeffbaldock/Library/CloudStorage/GoogleDrive-jbaldock@uwyo.edu/Shared drives/wyo-coop-baldock/UWyoming/Snake River Cutthroat/Analyses/Groundwater Seeps/SpringTIFFs/SpringPrev_SnakeGreys_BedSurf_nolakes.tif\")\nwriteRaster(spring_nolakes_buff100, \"/Users/jeffbaldock/Library/CloudStorage/GoogleDrive-jbaldock@uwyo.edu/Shared drives/wyo-coop-baldock/UWyoming/Snake River Cutthroat/Analyses/Groundwater Seeps/SpringTIFFs/SpringPrev_SnakeGreys_BedSurf_nolakes_flowbuff100.tif\")\nLoad spring prevalence rasters\nCodespring_nolakes &lt;- rast(\"/Users/jeffbaldock/Library/CloudStorage/GoogleDrive-jbaldock@uwyo.edu/Shared drives/wyo-coop-baldock/UWyoming/Snake River Cutthroat/Analyses/Groundwater Seeps/SpringTIFFs/SpringPrev_SnakeGreys_BedSurf_nolakes.tif\")\nspring_nolakes_buff100 &lt;- rast(\"/Users/jeffbaldock/Library/CloudStorage/GoogleDrive-jbaldock@uwyo.edu/Shared drives/wyo-coop-baldock/UWyoming/Snake River Cutthroat/Analyses/Groundwater Seeps/SpringTIFFs/SpringPrev_SnakeGreys_BedSurf_nolakes_flowbuff100.tif\")\nView MaxEnt spring prevalnce raster\nCodeoptions(terra.pal=rev(viridis(100)))\nplot(spring_nolakes)\nBuffered to flowline…\nCodeplot(spring_nolakes_buff100)\nReporting unit locations and watersheds\nCode# reporting unit locations\nsites_repu &lt;- vect(\"/Users/jeffbaldock/Library/CloudStorage/GoogleDrive-jbaldock@uwyo.edu/Shared drives/wyo-coop-baldock/UWyoming/Snake River Cutthroat/Analyses/Snake River GSI Quarto/Landscape Covariates/Location Data/RepUnit_SpatialLocations.shp\")\n\n# watershed shapefiles\nsheds_repu &lt;- read_sf(dsn = \"/Users/jeffbaldock/Library/CloudStorage/GoogleDrive-jbaldock@uwyo.edu/Shared drives/wyo-coop-baldock/UWyoming/Snake River Cutthroat/Analyses/Snake River GSI Quarto/Landscape Covariates/Watershed Delineation\", layer = \"RepUnits_Watersheds\")\nView reporting units and watersheds\nCodemapview(list(st_as_sf(sites_repu), sheds_repu), col.regions = c(\"blue\", \"white\"), col = c(\"blue\", \"blue\"), alpha.regions = c(1,0.2), legend = F)",
    "crumbs": [
      "Landscape attributes",
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Groundwater</span>"
    ]
  },
  {
    "objectID": "Landscape Covariates/Groundwater/GroundwaterIndex.html#derive-groundwater-metrics",
    "href": "Landscape Covariates/Groundwater/GroundwaterIndex.html#derive-groundwater-metrics",
    "title": "\n7  Groundwater\n",
    "section": "\n7.2 Derive groundwater metrics",
    "text": "7.2 Derive groundwater metrics\nCalculate groundwater metrics for each basin. Extract average and weighted spring prevalence for each basin\n\nCode# \nsites &lt;- sheds_repu$site\ngwlist &lt;- list()\nst &lt;- Sys.time()\nfor (i in 1:length(sites)) {\n  spring_mask &lt;- mask(crop(spring_nolakes_buff100, sheds_repu[sheds_repu$site == sites[i],]), sheds_repu[sheds_repu$site == sites[i],]) # crop and mask by basin\n  dist_rast &lt;- distance(spring_mask, sites_repu[sites_repu$repunit == sites[i],]) %&gt;% mask(spring_mask) # calculate distance between each raster cell and site location\n  gwlist[[i]] &lt;- tibble(site = sites[i],\n                        areasqkm = sheds_repu$aresqkm[i],\n                        gwi_point = terra::extract(spring_nolakes_buff100, sites_repu[sites_repu$repunit == sites[i],], na.rm = TRUE)[,2],\n                        gwi_iew05km = as.numeric(global(spring_mask * (1 / exp(dist_rast/5000)), \"sum\", na.rm = T) / global(1 / exp(dist_rast/5000), \"sum\", na.rm = T))\n  )\n  print(i)\n}\nSys.time() - st\ngwmetrics_repu &lt;- do.call(rbind, gwlist) # bind as tibble\nwrite_csv(gwmetrics_repu, \"Landscape Covariates/Groundwater/GroundwaterMetrics_raw_RepUnits.csv\")\n\n\n\nCodegwmetrics_repu &lt;- read_csv(\"/Users/jeffbaldock/Library/CloudStorage/GoogleDrive-jbaldock@uwyo.edu/Shared drives/wyo-coop-baldock/UWyoming/Snake River Cutthroat/Analyses/Snake River GSI Quarto/Landscape Covariates/Groundwater/GroundwaterMetrics_raw_RepUnits.csv\")\ngwmetrics_repu %&gt;% kable()\n\n\n\nsite\nareasqkm\ngwi_point\ngwi_iew05km\n\n\n\nbailey_NA\n41.5714362\n0.0095202\n0.0281587\n\n\nblackrock_lower\n124.9215920\n0.1393530\n0.0438536\n\n\nblackrock_upper\n80.6862046\n0.1924090\n0.0685266\n\n\nblacktail_NA\n61.1445506\n0.1783010\n0.2664975\n\n\nblindbull_NA\n36.3517449\n0.0473298\n0.0702745\n\n\nboulder_NA\n53.6999801\n0.1402050\n0.0497372\n\n\nbox_NA\n29.1414701\n0.0594441\n0.0251458\n\n\ncabin_NA\n23.5100427\n0.0558411\n0.0497856\n\n\nclear_NA\n16.6041016\n0.0753176\n0.0287769\n\n\ncliff_NA\n158.3813174\n0.2303060\n0.0598667\n\n\ncody_bluecrane\n18.5117071\n0.5193600\n0.2969744\n\n\ncottonwood_grosventre\n89.1780292\n0.1426020\n0.0742731\n\n\ncottonwood_nps\n187.1527021\n0.4438450\n0.1516091\n\n\ncowboycabin_NA\n6.6392953\nNA\n0.1510349\n\n\ncrystal_lower\n185.1148874\n0.0840567\n0.0534595\n\n\ncrystal_upper\n155.6115004\n0.0156552\n0.0350789\n\n\ndeadman_greys\n42.6069634\n0.0568219\n0.0415624\n\n\ndeadmansbar_NA\n11.7612083\n0.4607530\n0.1228488\n\n\ndell_NA\n118.1568591\n0.2145850\n0.0506646\n\n\nditch_NA\n67.6914863\n0.0331338\n0.0379450\n\n\ndog_NA\n31.0904837\n0.0636842\n0.0618599\n\n\nfall_coburn\n116.5315084\n0.2628070\n0.1059285\n\n\nfish_NA\n233.3741441\n0.1869660\n0.1932733\n\n\nfish_grosventre\n587.8758585\n0.0790754\n0.0570004\n\n\nflat_NA\n173.3686411\n0.4952880\n0.2374473\n\n\nfordspring_NA\n0.3712985\n0.3635020\n0.3083826\n\n\ngoosewing_NA\n40.3960756\n0.1272550\n0.0449844\n\n\ngranite_lower\n220.3826608\n0.4365610\n0.0792698\n\n\ngranite_upper\n131.1747886\n0.0685593\n0.0512103\n\n\ngrosventre_lower\n1589.6465468\n0.1128500\n0.1277220\n\n\nhoback_upper\n114.0778330\n0.1322940\n0.0672652\n\n\nhorse_NA\n63.2035547\n0.3199460\n0.0541071\n\n\nlava_NA\n65.3337290\n0.1542410\n0.0371282\n\n\nleidy_NA\n10.7360331\n0.0376180\n0.0454852\n\n\nlittlegreys_steer\n179.3457294\n0.1819260\n0.0565315\n\n\nlowerbarbc_NA\n6.3968311\n0.3782680\n0.2384035\n\n\nmosquito_NA\n61.6412867\n0.5507170\n0.0881280\n\n\nnorthbuffalofork_NA\n211.7277107\n0.4812010\n0.1090835\n\n\npacific_NA\n415.0574929\n0.1369520\n0.0415821\n\n\nrock_NA\n11.9857990\n0.0256445\n0.0192197\n\n\nshoal_NA\n82.6496949\n0.1540520\n0.0655054\n\n\nslate_NA\n97.2568238\n0.0359981\n0.0333669\n\n\nsnakeriversidechannel_NA\n18.8103796\n0.5644690\n0.3722617\n\n\nspread_southfork\n98.9032021\n0.0189719\n0.0327670\n\n\nspread_uppermainstem\n202.6088599\n0.0736471\n0.0452715\n\n\nspreadnf_flagstaff\n62.1057535\n0.0557931\n0.0769342\n\n\nspring_nps\n4.0130319\n0.2528840\n0.0921442\n\n\nspring_tss\n24.8578294\n0.3593580\n0.2004281\n\n\nthreechannel_NA\n32.3647548\n0.2897590\n0.1178438\n\n\nupperbarbc_NA\n5.7370505\n0.4632450\n0.3517652\n\n\nwhite_NA\n32.6721618\n0.1206510\n0.0640540\n\n\nwillow_NA\n185.7033361\n0.3712950\n0.0722065\n\n\n\n\n\n\nCodesites_repu &lt;- sort(sites_repu, \"repunit\")\ngwmetrics_repu &lt;- arrange(gwmetrics_repu, site)\nsites_repu$gwi &lt;- gwmetrics_repu$gwi_iew05km\nmapview(sites_repu, zcol = \"gwi\", col.regions = viridis::viridis(n = 10, direction = -1))",
    "crumbs": [
      "Landscape attributes",
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Groundwater</span>"
    ]
  }
]